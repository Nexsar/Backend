# Nexsar - Backend

> This platform enables a seamless and `decentralized` content generation and voting system, allowing distributors to `create posts`, `manage rewards`, and workers to participate in post evaluations. It integrates `smart contracts`, `database normalization`, `atomic transactions`, and `blockchain technology` to provide transparency, scalability, and automated processes.

## Technologyy

| Tools         | Usage                                              |
| ------------- | -------------------------------------------------- |
| **postgres**  | Backup Data & Fast Fetch                           |
| **prisma**    | Make DB schema                                     |
| **ethers.js** | interact with blockchain                           |
| **OpenAI**    | generate contents                                  |
| **Galadriel** | generate options (images) for post based on prompt |

---

## Installation Guide

> Clone Repo:
```sh
git clone https://github.com/Nexsar/Backend
```

>> Distributor:

> Setup:
```sh
cd distributor
npm i
npm i -g typescript # if no typescript
```

> Run:
```sh
tsc -b
node dist/index.js
```

>> Worker:

> Setup:
```sh
cd worker
npm i
```

> Run:
```sh
tsc -b
node dist/index.js
```

---

## Table of Contents
- [Nexsar - Backend](#nexsar---backend)
  - [Technologyy](#technologyy)
  - [Installation Guide](#installation-guide)
  - [Table of Contents](#table-of-contents)
  - [Distributor Features](#distributor-features)
  - [Worker Features](#worker-features)
  - [Key Technical Concepts](#key-technical-concepts)
    - [Agent Spawning](#agent-spawning)
    - [Atomic Transactions](#atomic-transactions)
    - [Blockchain State Updates](#blockchain-state-updates)
    - [Critical State Updates](#critical-state-updates)

---

## Distributor Features

1. **Schema and Database Normalization**
   - The platform utilizes a well-defined schema with foreign key relationships, ensuring data consistency through **DB normalization**. This optimization allows for efficient data storage and management.

2. **Agent Creation**
   - As soon as a distributor is created, an **Agent** is automatically spawned (OpenAI-based), dedicated to that user.
   - **1 Agent per User**: Each distributor has a personalized agent that assists in content generation.
   - The agent is capable of **auto-uploading posts** without manual intervention from the distributor, streamlining the content publishing process.

3. **Cron Job**
   - We use user provided `frequency` to run a `cronjob` which will auto create the Post for the dostributor and use `Lit Actions` to auto sign the transaction to send data to the blockchain. (without any intervention).
   -

4. **Post Management**
   - Distributors have full control over posts and can **close posts** at any time. Upon closing:
     - The allocated rewards will be automatically distributed among the winners.
     - Workers who have contributed to the post evaluation will receive their rewards instantly.

5. **Atomic Transactions**
   - The platform ensures the use of **Database Atomic Transactions**, which guarantees that all steps of a transaction are completed successfully or rolled back entirely. This feature maintains the **atomicity** of transactions, ensuring consistency even during complex state changes or multi-step operations.

6. **State Management and Blockchain Updates**
   - To maintain scalability and reduce gas fees, the platform pushes state updates to the blockchain **after every 10 micro-transactions** (for demo) or **100 micro-transactions** (for the actual protocol).
   - This process ensures that:
     - Gas costs are minimized.
     - Transparency is upheld.
     - Scalability is enhanced by batching multiple small transactions into a single on-chain update.

7. **Reward Distribution**
   - As soon as a post is ended by the distributor, the system automatically updates the **rewards** for the winners.
   - Winners can **redeem their rewards** at any point in time.

---

## Worker Features

1. **Voting and Evaluation**
   - Workers can easily view posts generated by the agent and cast their votes based on the content.
   - Votes are submitted directly to the platform, and rewards are distributed based on the voting results.

2. **Reward System**
   - Workers are incentivized for their contributions. Once the post is finalized by the distributor, workers receive rewards based on the outcome of the voting process.

---

## Key Technical Concepts

### Agent Spawning
- Each distributor is automatically assigned an **OpenAI Agent** that aids in content generation. This agent handles tasks such as content uploading and management without requiring manual intervention.
- For option (image) generation we are uinf `Galadriel` smart contract which uses **`DALL-E`** model to generate Images based on prompt provided.

### Atomic Transactions
- **Atomic transactions** ensure that all operations within a transaction either complete successfully or not at all.
  This feature is crucial for maintaining **data integrity** and ensuring the system operates smoothly even during failure scenarios.
  Atomic transactions help in managing complex, multi-step actions such as content generation, voting, and reward distribution.

### Blockchain State Updates
- The platform optimizes blockchain transactions by **batching micro-transactions** and updating the state in bulk. This approach:
  - Reduces the frequency of on-chain updates.
  - Lowers gas fees for distributors.
  - Ensures transparency and scalability by reflecting important events like votes and post status changes on the blockchain.

### Critical State Updates
- **Critical updates** such as:
  - Worker reward adjustments.
  - Vote mapping for workers.
  - Updating vote counts for posts.

  These actions can only be performed by the contract owner (the platform administrators), ensuring that critical state changes are secure and only executed by authorized entities.

---

This platform offers an advanced solution for decentralized content generation, post management, and reward distribution, empowering both distributors and workers while maintaining robust security and scalability.